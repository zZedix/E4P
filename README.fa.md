# رمزگذاری برای مردم (E4P)

یک برنامه وب مدرن و امن برای رمزگذاری فایل‌ها با رمزنگاری قوی. E4P رمزگذاری سمت کلاینت را با استفاده از الگوریتم‌ها و توابع استخراج کلید استاندارد صنعتی ارائه می‌دهد و اطمینان می‌دهد که فایل‌های شما حتی در صورت به خطر افتادن سرور نیز امن باقی می‌مانند.

**📖 [README in English](README.md)**

## 🌟 الهام‌بخش

این پروژه از **جنبش سایفرپانک** و **نرم‌افزار E4M** الهام گرفته است و از حریم خصوصی و امنیت قوی برای همه در اینترنت حمایت می‌کند. ما معتقدیم که رمزگذاری باید برای همه قابل دسترسی باشد، نه فقط برای کسانی که تخصص فنی دارند.

## 🔐 ویژگی‌های امنیتی

- **رمزگذاری قوی**: الگوریتم‌های AES-256-GCM و XChaCha20-Poly1305
- **استخراج کلید امن**: Argon2id با پارامترهای قابل تنظیم
- **عدم ذخیره کلید**: کلیدها هرگز روی سرور ذخیره نمی‌شوند
- **رمزگذاری جریانی**: فایل‌های بزرگ را بدون مشکل حافظه مدیریت می‌کند
- **رمزگذاری احراز هویت**: از دستکاری جلوگیری می‌کند و یکپارچگی را تضمین می‌کند
- **توکن‌های دانلود امن**: لینک‌های دانلود محدود به زمان و امضا شده با HMAC

## 🚀 شروع سریع

### نصب و اجرای یک خطی

**لینوکس/macOS (توصیه شده):**
```bash
curl -sSL https://raw.githubusercontent.com/zZedix/E4P/main/install.sh | bash
```

**ویندوز:**
```cmd
git clone https://github.com/zZedix/E4P.git && cd E4P && install.bat
```

**نکته**: نصب یک خطی به طور خودکار تمام وابستگی‌ها را نصب می‌کند و سرور را راه‌اندازی می‌کند. هیچ پیکربندی دستی مورد نیاز نیست!

## 🖥️ رابط خط فرمان (CLI)

E4P شامل یک CLI قدرتمند برای مدیریت آسان است. پس از نصب، می‌توانید از دستور `E4P` از هر جای استفاده کنید:

### حالت تعاملی
```bash
E4P
```

### دستورات مستقیم
```bash
E4P status      # نمایش وضعیت برنامه
E4P start       # راه‌اندازی سرور
E4P stop        # توقف سرور
E4P restart     # راه‌اندازی مجدد سرور
E4P update      # به‌روزرسانی به آخرین نسخه
E4P logs        # مشاهده لاگ‌های برنامه
E4P config      # ویرایش پیکربندی
E4P test        # اجرای تست‌ها
E4P install     # نصب وابستگی‌ها
E4P clean       # پاک کردن فایل‌های موقت
```

### ویژگی‌های CLI
- **نظارت بر وضعیت**: بررسی اجرای E4P، مشاهده PID، زمان اجرا، استفاده از حافظه
- **مدیریت فرآیند**: راه‌اندازی، توقف، راه‌اندازی مجدد سرور
- **به‌روزرسانی**: دریافت آخرین تغییرات و راه‌اندازی مجدد خودکار
- **لاگ‌ها**: مشاهده لاگ‌های برنامه در زمان واقعی
- **پیکربندی**: ویرایش تنظیمات با ویرایشگر مورد نظر شما
- **تست**: اجرای تست‌های برنامه
- **نگهداری**: پاک کردن فایل‌های موقت و نصب مجدد وابستگی‌ها

### نصب دستی

1. **کلون و راه‌اندازی**:
   ```bash
   git clone https://github.com/zZedix/E4P.git
   cd E4P
   python -m venv .venv
   source .venv/bin/activate  # در ویندوز: .venv\Scripts\activate
   pip install -r requirements.txt
   ```

2. **پیکربندی محیط**:
   ```bash
   cp env.example .env
   # ویرایش .env با تنظیمات خود
   ```

3. **اجرای برنامه**:
   ```bash
   python run.py
   ```

4. **دسترسی به برنامه**:
   باز کردن http://localhost:8080 در مرورگر

### استقرار Docker

1. **استفاده از Docker Compose** (توصیه شده):
   ```bash
   # تولید کلید مخفی امن
   SECRET_KEY=$(openssl rand -base64 32)
   
   # تنظیم کلید مخفی در .env
   echo "SECRET_KEY=$SECRET_KEY" > .env
   
   # راه‌اندازی برنامه
   docker-compose up -d
   ```

2. **استفاده از Docker مستقیماً**:
   ```bash
   # تولید کلید مخفی امن
   SECRET_KEY=$(openssl rand -base64 32)
   
   # ساخت تصویر
   docker build -t e4p .
   
   # ایجاد حجم برای فایل‌های موقت
   docker volume create e4p_temp
   
   # اجرای کانتینر
   docker run -d \
     --name e4p-app \
     -p 8080:8080 \
     -e SECRET_KEY="$SECRET_KEY" \
     -v e4p_temp:/tmp/e4p \
     --restart unless-stopped \
     e4p
   ```

3. **استفاده از CLI (جایگزین)**:
   ```bash
   # نصب و راه‌اندازی با CLI
   curl -sSL https://raw.githubusercontent.com/zZedix/E4P/main/install.sh | bash
   
   # یا اگر قبلاً نصب شده
   E4P start
   ```

## 📁 فرمت فایل E4P

E4P از فرمت کانتینر باینری سفارشی با ساختار زیر استفاده می‌کند:

```
+------------------+
| Magic: "E4P1"    | 4 بایت
+------------------+
| طول هدر          | 4 بایت (uint32 little-endian)
+------------------+
| JSON هدر         | طول متغیر
+------------------+
| داده‌های رمزگذاری شده | طول متغیر
+------------------+
```

### ساختار JSON هدر

```json
{
  "alg": "AES-256-GCM" | "XCHACHA20-POLY1305",
  "kdf": "argon2id",
  "kdf_params": {
    "m": 262144,  // هزینه حافظه به کیلوبایت
    "t": 3,       // هزینه زمان
    "p": 2        // موازی‌سازی
  },
  "salt": "salt_encoded_base64",
  "nonce": "nonce_encoded_base64",
  "orig_name": "original_filename.txt",
  "orig_size": 1024,
  "ts": "2024-01-01T00:00:00Z"
}
```

## 🔧 پیکربندی

### متغیرهای محیطی

| متغیر | پیش‌فرض | توضیحات |
|--------|---------|---------|
| `APP_HOST` | `0.0.0.0` | هاست سرور |
| `APP_PORT` | `8080` | پورت سرور |
| `MAX_FILE_SIZE_MB` | `2048` | حداکثر اندازه فایل به مگابایت |
| `MAX_CONCURRENCY` | `2` | حداکثر کارهای رمزگذاری همزمان |
| `ARGON2_MEMORY_MB` | `256` | هزینه حافظه Argon2id به مگابایت |
| `ARGON2_TIME_COST` | `3` | هزینه زمان Argon2id |
| `ARGON2_PARALLELISM` | `2` | موازی‌سازی Argon2id |
| `ARGON2_KEY_LEN` | `32` | طول کلید استخراج شده به بایت |
| `CLEAN_INTERVAL_MIN` | `5` | فاصله پاکسازی به دقیقه |
| `FILE_TTL_MIN` | `60` | زمان زندگی فایل به دقیقه |
| `DOWNLOAD_TOKEN_TTL_S` | `900` | TTL توکن دانلود به ثانیه |
| `SECRET_KEY` | `change_me_to_random_base64` | کلید مخفی برای امضای توکن |
| `RATE_LIMIT_REQUESTS_PER_MINUTE` | `60` | محدودیت نرخ برای درخواست‌های API |

### تنظیم پارامترهای KDF

پارامترهای Argon2id را می‌توان بر اساس سخت‌افزار شما تنظیم کرد:

**برای رمزگذاری سریع‌تر (کمتر امن)**:
```env
ARGON2_MEMORY_MB=64
ARGON2_TIME_COST=2
ARGON2_PARALLELISM=1
```

**برای حداکثر امنیت (کندتر)**:
```env
ARGON2_MEMORY_MB=512
ARGON2_TIME_COST=5
ARGON2_PARALLELISM=4
```

**توصیه شده برای تولید**:
```env
ARGON2_MEMORY_MB=256
ARGON2_TIME_COST=3
ARGON2_PARALLELISM=2
```

## 🌐 مرجع API

### نقاط پایانی رمزگذاری

#### `POST /api/encrypt`
رمزگذاری یک یا چند فایل.

**درخواست**:
- `files`: لیست فایل‌ها (multipart/form-data)
- `password`: رمز عبور کاربر (فیلد فرم)
- `algorithm`: "AES-256-GCM" یا "XCHACHA20-POLY1305" (فیلد فرم)

**پاسخ**:
```json
{
  "task_id": "uuid",
  "files": [
    {
      "original_name": "file.txt",
      "size": 1024
    }
  ],
  "algorithm": "AES-256-GCM",
  "status": "pending"
}
```

#### `GET /api/status/{task_id}`
دریافت وضعیت کار رمزگذاری.

**پاسخ**:
```json
{
  "task_id": "uuid",
  "status": "completed",
  "progress": 100.0,
  "files": [...],
  "created_at": "2024-01-01T00:00:00Z",
  "completed_at": "2024-01-01T00:01:00Z"
}
```

### نقاط پایانی رمزگشایی

#### `POST /api/decrypt`
رمزگشایی فایل E4P.

**درخواست**:
- `file`: فایل E4P (multipart/form-data)
- `password`: رمز عبور کاربر (فیلد فرم)

**پاسخ**:
```json
{
  "download_token": "base64_token",
  "filename": "original_file.txt",
  "size": 1024,
  "algorithm": "AES-256-GCM",
  "status": "success"
}
```

### نقاط پایانی دانلود

#### `GET /download/{token}`
دانلود فایل رمزگذاری یا رمزگشایی شده با استفاده از توکن امن.

#### `GET /download-stream/{token}`
دانلود جریانی برای فایل‌های بزرگ.

## 🧪 تست

اجرای مجموعه تست:

```bash
# نصب وابستگی‌های تست
pip install pytest pytest-asyncio httpx

# اجرای تمام تست‌ها
pytest

# اجرا با پوشش
pytest --cov=app

# اجرای فایل تست خاص
pytest tests/test_encrypt_flow.py -v
```

## 🛡️ ملاحظات امنیتی

### آنچه E4P در برابر آن محافظت می‌کند

- **به خطر افتادن سرور**: کلیدها هرگز روی سرور ذخیره نمی‌شوند
- **رصد شبکه**: تمام داده‌ها قبل از انتقال رمزگذاری می‌شوند
- **دستکاری فایل**: رمزگذاری احراز هویت از تغییر جلوگیری می‌کند
- **حملات تکرار**: nonce منحصر به فرد برای هر عملیات رمزگذاری
- **حمله بی‌رحم**: Argon2id رمزگشایی رمز عبور را از نظر محاسباتی پرهزینه می‌کند

### آنچه E4P در برابر آن محافظت نمی‌کند

- **رمزهای عبور گم شده**: کلیدها از رمزهای عبور استخراج می‌شوند؛ رمز عبور گم شده = داده گم شده
- **سرور مخرب**: سرور می‌تواند رمزهای عبور را ثبت کند یا کد سمت کلاینت را تغییر دهد
- **حملات سمت کلاینت**: بدافزار روی دستگاه کاربر می‌تواند رمزهای عبور را بدزدد
- **حملات کانال جانبی**: حملات زمان‌بندی در تأیید رمز عبور

### بهترین شیوه‌ها

1. **استفاده از رمزهای عبور قوی**: حداقل 12 کاراکتر با حروف بزرگ، کوچک، اعداد و نمادها
2. **نگهداری امن رمزهای عبور**: ذخیره در مدیر رمز عبور
3. **تأیید دانلود‌ها**: بررسی یکپارچگی فایل پس از دانلود
4. **استفاده از HTTPS**: همیشه از طریق اتصالات رمزگذاری شده دسترسی پیدا کنید
5. **به‌روزرسانی منظم**: برنامه را به‌روز نگه دارید

## 🌍 بین‌المللی‌سازی

E4P از چندین زبان پشتیبانی می‌کند:

- **انگلیسی** (پیش‌فرض)
- **فارسی** (فارسی)

زبان را می‌توان با استفاده از منوی کشویی در نوار ناوبری تغییر داد. رابط به طور خودکار جهت متن را برای زبان‌های RTL تنظیم می‌کند.

## 🏗️ معماری

```
e4p/
├── app/
│   ├── main.py              # برنامه FastAPI
│   ├── config.py            # مدیریت پیکربندی
│   ├── crypto/              # ماژول‌های رمزنگاری
│   │   ├── kdf.py          # توابع استخراج کلید
│   │   ├── aead.py         # الگوریتم‌های رمزگذاری
│   │   ├── container.py    # فرمت فایل E4P
│   │   └── stream.py       # رمزگذاری جریانی
│   ├── routes/             # نقاط پایانی API
│   │   ├── encrypt.py      # نقاط پایانی رمزگذاری
│   │   ├── decrypt.py      # نقاط پایانی رمزگشایی
│   │   └── download.py     # نقاط پایانی دانلود
│   ├── services/           # منطق کسب‌وکار
│   │   ├── tasks.py        # مدیریت کار
│   │   ├── storage.py      # ذخیره‌سازی فایل
│   │   └── tokens.py       # مدیریت توکن
│   ├── templates/          # قالب‌های HTML
│   └── static/             # دارایی‌های CSS/JS
├── tests/                  # مجموعه تست
├── Dockerfile             # پیکربندی Docker
├── docker-compose.yml     # راه‌اندازی Docker Compose
└── requirements.txt       # وابستگی‌های Python
```

## 🤝 مشارکت

1. Fork کردن مخزن
2. ایجاد شاخه ویژگی
3. ایجاد تغییرات شما
4. اضافه کردن تست برای عملکرد جدید
5. اطمینان از عبور تمام تست‌ها
6. ارسال درخواست pull

## 💰 کمک‌های مالی

اگر E4P را مفید می‌دانید و می‌خواهید از توسعه آن پشتیبانی کنید، کمک مالی در نظر بگیرید:

**کمک‌های مالی ارز دیجیتال:**
- **Tron (TRX)**: `TD43B2eT7JC8upacMarcmBBGFkjy75QJHK`
- **USDT (BEP20)**: `0x8Fb2c4AF74e072CefC14A4E9927a1F86F1cd492c`
- **TON**: `UQAFTGSc2YRNGQwwuTyD0Q-eB7pB0BNG0yvx5jVYAJWFu-y6`

پشتیبانی شما به ما کمک می‌کند تا E4P را نگهداری و بهبود دهیم و اطمینان حاصل کنیم که رایگان و در دسترس همه کسانی که حریم خصوصی و امنیت خود را ارزش‌مند می‌دانند باقی بماند.

## 📄 مجوز

این پروژه تحت مجوز MIT مجوز دارد - برای جزئیات فایل LICENSE را ببینید.

## ⚠️ سلب مسئولیت

این نرم‌افزار "همان‌طور که هست" بدون ضمانت ارائه می‌شود. نویسندگان مسئول از دست دادن داده یا نقض امنیت نیستند. همیشه از داده‌های خود پشتیبان تهیه کنید و از رمزهای عبور قوی استفاده کنید.

## 🔗 لینک‌ها

- [مستندات FastAPI](https://fastapi.tiangolo.com/)
- [کتابخانه رمزنگاری](https://cryptography.io/)
- [مشخصات Argon2](https://github.com/P-H-C/phc-winner-argon2)
- [مشخصات AES-GCM](https://tools.ietf.org/html/rfc5288)
- [مشخصات XChaCha20-Poly1305](https://tools.ietf.org/html/draft-irtf-cfrg-xchacha)
